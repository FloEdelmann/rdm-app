angular.module("rdmApp",[]).config(["$interpolateProvider",function(a){"use strict";a.startSymbol("{[{"),a.endSymbol("}]}")}]).constant("RDM",{COMMAND_CLASS:{DISCOVERY_COMMAND:16,DISCOVERY_COMMAND_RESPONSE:17,GET_COMMAND:32,GET_COMMAND_RESPONSE:33,SET_COMMAND:48,SET_COMMAND_RESPONSE:49},EUID_SIZE:16,NACK_REASON:{NR_UNKNOWN_PID:0,NR_FORMAT_ERROR:1,NR_HARDWARE_FAULT:2,NR_PROXY_REJECT:3,NR_WRITE_PROTECT:4,NR_UNSUPPORTED_COMMAND_CLASS:5,NR_DATA_OUT_OF_RANGE:6,NR_BUFFER_FULL:7,NR_PACKET_SIZE_UNSUPPORTED:8,NR_SUB_DEVICE_OUT_OF_RANGE:9,NR_PROXY_BUFFER_FULL:10,NR_ACTION_NOT_SUPPORTED:11},PIDS:{DISC_UNIQUE_BRANCH:1,DISC_MUTE:2,DISC_UN_MUTE:3,PROXIED_DEVICES:16,PROXIED_DEVICE_COUNT:17,COMMS_STATUS:21,QUEUED_MESSAGE:32,STATUS_MESSAGES:48,STATUS_ID_DESCRIPTION:49,CLEAR_STATUS_ID:50,SUB_DEVICE_STATUS_REPORT_THRESHOLD:51,SUPPORTED_PARAMETERS:80,PARAMETER_DESCRIPTION:81,DEVICE_INFO:96,PRODUCT_DETAIL_ID_LIST:112,DEVICE_MODEL_DESCRIPTION:128,MANUFACTURER_LABEL:129,DEVICE_LABEL:130,FACTORY_DEFAULTS:144,LANGUAGE_CAPABILITIES:160,LANGUAGE:176,SOFTWARE_VERSION_LABEL:192,BOOT_SOFTWARE_VERSION_ID:193,BOOT_SOFTWARE_VERSION_LABEL:194,DMX_PERSONALITY:224,DMX_PERSONALITY_DESCRIPTION:225,DMX_START_ADDRESS:240,SLOT_INFO:288,SLOT_DESCRIPTION:289,DEFAULT_SLOT_VALUE:290,SENSOR_DEFINITION:512,SENSOR_VALUE:513,RECORD_SENSORS:514,DEVICE_HOURS:1024,LAMP_HOURS:1025,LAMP_STRIKES:1026,LAMP_STATE:1027,LAMP_ON_MODE:1028,DEVICE_POWER_CYCLES:1029,DISPLAY_INVERT:1280,DISPLAY_LEVEL:1281,PAN_INVERT:1536,TILT_INVERT:1537,PAN_TILT_SWAP:1538,REAL_TIME_CLOCK:1539,IDENTIFY_DEVICE:4096,RESET_DEVICE:4097,POWER_STATE:4112,PERFORM_SELFTEST:4128,SELF_TEST_DESCRIPTION:4129,CAPTURE_PRESET:4144,PRESET_PLAYBACK:4145,DMX_BLOCK_ADDRESS:320,DMX_FAIL_MODE:321,DMX_STARTUP_MODE:322,DIMMER_INFO:832,MINIMUM_LEVEL:833,MAXIMUM_LEVEL:834,CURVE:835,CURVE_DESCRIPTION:836,OUTPUT_RESPONSE_TIME:837,OUTPUT_RESPONSE_TIME_DESCRIPTION:838,MODULATION_FREQUENCY:839,MODULATION_FREQUENCY_DESCRIPTION:840,BURN_IN:1088,LOCK_PIN:1600,LOCK_STATE:1601,LOCK_STATE_DESCRIPTION:1602,IDENTIFY_MODE:4160,PRESET_INFO:4161,PRESET_STATUS:4162,PRESET_MERGEMODE:4163,POWER_ON_SELF_TEST:4164,LIST_INTERFACES:1792,INTERFACE_LABEL:1793,INTERFACE_HARDWARE_ADDRESS_TYPE1:1794,IPV4_DHCP_MODE:1795,IPV4_ZEROCONF_MODE:1796,IPV4_CURRENT_ADDRESS:1797,IPV4_STATIC_ADDRESS:1798,INTERFACE_RENEW_DHCP:1799,INTERFACE_RELEASE_DHCP:1800,INTERFACE_APPLY_CONFIGURATION:1801,IPV4_DEFAULT_ROUTE:1802,DNS_NAME_SERVER:1803,DNS_HOSTNAME:1804,DNS_DOMAIN_NAME:1805},RESPONSE_TYPE:{ACK:0,ACK_TIMER:1,NACK:2,ACK_OVERFLOW:3},START_CODE:204,SUB_DEVICE:{ROOT_DEVICE:0,ALL_SUB_DEVICES:65535},UID_SIZE:6}).constant("OUTPUT_FORMAT",{C_ARRAY:{label:"C Array",value:0},C_STRING:{label:"C String",value:1},RAW_HEX:{label:"Raw Hex",value:2}}).service("checksumService",function(){"use strict";var a=function(a){var b=a.reduce(function(a,b,c,d){return a+b});return b};this.checksumAsArray=function(b){var c=a(b);return[c>>8,255&c]},this.checksumAsValue=a}).service("rdmHelperService",["RDM",function(a){"use strict";this.isRequest=function(b){return b===a.COMMAND_CLASS.DISCOVERY_COMMAND||b===a.COMMAND_CLASS.GET_COMMAND||b===a.COMMAND_CLASS.SET_COMMAND},this.isResponse=function(b){return b===a.COMMAND_CLASS.DISCOVERY_COMMAND_RESPONSE||b===a.COMMAND_CLASS.GET_COMMAND_RESPONSE||b===a.COMMAND_CLASS.SET_COMMAND_RESPONSE},this.isGetSet=function(b){return b===a.COMMAND_CLASS.GET_COMMAND||b===a.COMMAND_CLASS.GET_COMMAND_RESPONSE||b===a.COMMAND_CLASS.SET_COMMAND||b===a.COMMAND_CLASS.SET_COMMAND_RESPONSE}}]).service("formatService",["RDM",function(a){"use strict";var b=function(a){return new Array(a+1).join(" ")},c=function(a,b,c){var d=a.toString(16),e=b-d.length+1;return(c?c:"")+new Array(+(e>0&&e)).join("0")+d};this.toHex=c,this.reverseLookup=function(a,b){var c="";return angular.forEach(a,function(a,d){a===b&&(c=d)}),c},this.arrayToUID=function(b){return b.length!==a.UID_SIZE?"":c(b[0],2)+c(b[1],2)+":"+c(b[2],2)+c(b[3],2)+c(b[4],2)+c(b[5],2)},this.arrayToHex=function(a,b){return a.map(function(a){return c(a,2,b)})},this.dataAsArray=function(a,d){for(var e=2,f="const uint8_t packet[] = {",g=[f],h=b(2),i=0;i<a.length;++i){var j=c(a[i],2,"0x");h.length+j.length+2>=d?(h+=",",g.push(h),h=b(e)):h.length!==e&&(h+=", "),h+=j}return h&&g.push(h),g.push("};"),g.join("\n")},this.dataAsString=function(a,d){for(var e=[],f='const char packet[] = "',g=f,h=0;h<a.length;++h){var i=c(a[h],2,"\\x");g.length+i.length+2>=d&&(g+='"',e.push(g),g=b(f.length-1)+'"'),g+=i}return g&&(g+='";',e.push(g)),e.join("\n")},this.dataAsRawHex=function(a,b){for(var d=[],e="",f=0;f<a.length;++f){var g=c(a[f],2);e.length+g.length+1>=b&&(d.push(e),e=""),e+=g,f+1!==a.length&&(e+=" ")}return e&&d.push(e),d.join("\n")}}]).service("parserService",["RDM",function(a){"use strict";this.textToBytes=function(a){var b=a.replace(/[,\s]/g,"").trim();if(!b.match(/^[0-9a-fA-F]*$/))return["Non hex characters",[]];if(b.length%2)return["Missing Bytes",[]];for(var c=[],d=0;d<b.length/2;d++){var e=b.slice(2*d,2*(d+1)),f=parseInt(e,16);if(isNaN(f))return["Invalid EUID: bad value"+e,[]];c.push(f)}return["",c]},this.uidToBytes=function(b){var c=b.replace(/[\.:\-\s]/g,"");if(!c.match(/^[0-9a-fA-F]{12}$/))return["Contains non hex characters",[]];var d=this.textToBytes(c);return d[0]?d:d[1].length!==a.UID_SIZE?["Incorrect size",[]]:d}}]).controller("UIDController",["$scope","checksumService","formatService","parserService",function(a,b,c,d){"use strict";a.invalid_input_message="Invalid UID, please enter a UID in the form MMMM:NNNNNNNN",a.uid="",a.euid="",a.error="",a.convertToEUID=function(){a.euid="",a.error="";var e=d.uidToBytes(a.uid);if(e[0])return void(a.error=a.invalid_input_message);var f=e[1],g=[];angular.forEach(f,function(a,b){this.push(170|a),this.push(85|a)},g);var h=b.checksumAsArray(g);angular.forEach(h,function(a,b){this.push(170|a),this.push(85|a)},g),a.euid=c.arrayToHex(g).join(" ")}}]).controller("EUIDController",["$scope","checksumService","formatService","parserService","RDM",function(a,b,c,d,e){"use strict";a.euid="",a.error="",a.uid="",a.convertToUID=function(){a.error="",a.uid="";var f=d.textToBytes(a.euid);if(f[0])return void(a.error="Invalid EUID: "+f[0]);var g=f[1];if(g.length!==e.EUID_SIZE)return void(a.error="Invalid EUID: insufficent data, should be 32 hex characters");var h=[];h.push(g[0]&g[1]),h.push(g[2]&g[3]),h.push(g[4]&g[5]),h.push(g[6]&g[7]),h.push(g[8]&g[9]),h.push(g[10]&g[11]);var i=((g[12]&g[13])<<8)+(g[14]&g[15]),j=b.checksumAsValue(g.slice(0,12));return i!==j?void(a.error="Checksum mismatch, was "+i+", calculated to be "+j):void(a.uid=c.arrayToUID(h))}}]).controller("RDMPacketBuilder",["$scope","$log","checksumService","parserService","formatService","rdmHelperService","OUTPUT_FORMAT","RDM",function(a,b,c,d,e,f,g,h){"use strict";function i(b,c,d){a.packet.command_class=b,a.properties.is_request=f.isRequest(b),l();var g=[];if(b===h.COMMAND_CLASS.DISCOVERY_COMMAND)g=["DISC_UNIQUE_BRANCH","DISC_MUTE","DISC_UN_MUTE"];else if(b===h.COMMAND_CLASS.DISCOVERY_COMMAND_RESPONSE)g=["DISC_MUTE","DISC_UN_MUTE"];else{var i=["DISC_UNIQUE_BRANCH","DISC_MUTE","DISC_UN_MUTE"];angular.forEach(h.PIDS,function(a,b){-1===i.indexOf(b)&&this.push(b)},g)}var j=!1,k=[];angular.forEach(g,function(b,c){j|=a.packet.param_id===h.PIDS[b];var d=b+" ("+e.toHex(h.PIDS[b],4,"0x")+")";this.push({label:d,value:h.PIDS[b]})},k),k.sort(function(a,b){return a.label===b.label?0:a.label>b.label?1:-1}),j||(a.packet.param_id=k[0].value),a.properties.pids=k}function j(b,c,d){a.packet.response_type=b,l()}a.packet={start_code:h.START_CODE,sub_start_code:1,dest_uid:"7a70:00000000",src_uid:"7a70:12345678",transaction_number:0,port_id:0,message_count:0,sub_device:0,command_class:h.COMMAND_CLASS.DISCOVERY_COMMAND,param_id:0,response_type:0,nack_reason:0,ack_timer:0,param_data:"",lower_uid:"",upper_uid:""},a.properties={is_request:!1,show_param_data:!1,pids:[]},a.settings={output_format:g.C_ARRAY.value,wrap:80},a.RDM=h,a.command_classes=[],angular.forEach(h.COMMAND_CLASS,function(a,b){this.push({value:a,label:b+" ("+e.toHex(a,2,"0x")+")"})},a.command_classes),a.command_classes.sort(function(a,b){return a.value===b.value?0:a.value>b.value?1:-1}),a.OUTPUT_FORMAT={},angular.forEach(g,function(a,b){this[a.label]=a.value},a.OUTPUT_FORMAT),a.output="",a.error="";var k=function(b,c){var e=d.uidToBytes(b);return e[0]?(a.error="Invalid "+c+" UID:"+e[0],""):e[1]},l=function(){a.properties.show_param_data=f.isGetSet(a.packet.command_class)&&(a.packet.response_type===h.RESPONSE_TYPE.ACK||a.packet.response_type===h.RESPONSE_TYPE.ACK_OVERFLOW)};a.$watch("packet.response_type",j),a.$watch("packet.command_class",i),a.buildPacket=function(){a.error="";var b=k(a.packet.dest_uid,"destination");if(b){var i=k(a.packet.src_uid,"source");if(i){var j=[];if(a.packet.command_class===h.COMMAND_CLASS.DISCOVERY_COMMAND&&a.packet.param_id===h.PIDS.DISC_UNIQUE_BRANCH){var l=k(a.packet.lower_uid,"lower");if(!l)return;var m=k(a.packet.upper_uid,"upper");if(!m)return;j=l.concat(m)}else if(f.isGetSet(a.packet.command_class))if(a.packet.response_type===h.RESPONSE_TYPE.ACK||a.packet.response_type===h.RESPONSE_TYPE.ACK_OVERFLOW){var n=d.textToBytes(a.packet.param_data);if(n[0])return void(a.error="Invalid parameter data:"+n[0]);j=n[1]}else a.packet.response_type===h.RESPONSE_TYPE.NACK?j=[a.packet.nack_reason>>8,255&a.packet.nack_reason]:a.packet.response_type===h.RESPONSE_TYPE.ACK_TIMER&&(j=[a.packet.ack_timer>>8,255&a.packet.ack_timer]);var o=[];o.push(a.packet.start_code),o.push(a.packet.sub_start_code),o.push(j.length+24),o=o.concat(b),o=o.concat(i),o.push(a.packet.transaction_number),f.isRequest(a.packet.command_class)?(o.push(a.packet.port_id),o.push(0)):(o.push(a.packet.response_type),o.push(a.packet.message_count)),o.push(a.packet.sub_device>>8),o.push(255&a.packet.sub_device),o.push(a.packet.command_class),o.push(a.packet.param_id>>8),o.push(255&a.packet.param_id),o.push(j.length),o=o.concat(j),o=o.concat(c.checksumAsArray(o)),a.settings.output_format===g.C_ARRAY.value?a.output=e.dataAsArray(o,a.settings.wrap):a.settings.output_format===g.C_STRING.value?a.output=e.dataAsString(o,a.settings.wrap):a.settings.output_format===g.RAW_HEX.value&&(a.output=e.dataAsRawHex(o,a.settings.wrap))}}}}]).controller("RDMPacketParser",["$scope","$log","checksumService","parserService","formatService","rdmHelperService","OUTPUT_FORMAT","RDM",function(a,b,c,d,e,f,g,h){"use strict";a.packet={start_code:"",sub_start_code:"",message_length:"",dest_uid:"",src_uid:"",transaction_number:"",port_id:"",message_count:"",sub_device:"",command_class:"",param_id:"",response_type:"",nack_reason:"",ack_timer:"",param_data_length:"",param_data:"",checksum:"",actual_size:"",calculated_checksum:""},a.packet_data="",a.show_output=!1;var i=function(){a.packet.start_code="",a.packet.sub_start_code="",a.packet.message_length="",a.packet.dest_uid="",a.packet.src_uid="",a.packet.transaction_number="",a.packet.port_id="",a.packet.message_count="",a.packet.sub_device="",a.packet.command_class="",a.packet.param_id="",a.packet.response_type="",a.packet.nack_reason="",a.packet.ack_timer="",a.packet.param_data_length="",a.packet.param_data="",a.packet.checksum="",a.packet.actual_size="",a.packet.calculated_checksum=""};a.reset=function(){i(),a.error="",a.packet_data="",a.show_output=!1},a.parsePacket=function(){i(),a.error="";var g=d.textToBytes(a.packet_data);if(g[0])return void(a.error="Invalid packet data:"+g[0]);var j=g[1],k=j.slice();if(a.packet.actual_size=j.length,!(j.length>=1))return void(a.error="Insufficient data for start code");if(a.packet.start_code=e.toHex(j.shift(),2,"0x"),a.show_output=!0,!(j.length>=1))return void(a.error="Insufficient data for sub start code");if(a.packet.sub_start_code=e.toHex(j.shift(),2,"0x"),!(j.length>=1))return void(a.error="Insufficient data for message length");if(a.packet.message_length=j.shift(),!(j.length>=h.UID_SIZE))return void(a.error="Insufficient data for destination UID");var l=j.slice(0,h.UID_SIZE);if(j=j.slice(h.UID_SIZE),a.packet.dest_uid=e.arrayToUID(l),!(j.length>=h.UID_SIZE))return void(a.error="Insufficient data for source UID");var m=j.slice(0,h.UID_SIZE);if(j=j.slice(h.UID_SIZE),a.packet.src_uid=e.arrayToUID(m),!(j.length>=1))return void(a.error="Insufficient data for transaction number");a.packet.transaction_number=j.shift();var n;if(!(j.length>=1))return void(a.error="Insufficient data for port ID / response type");if(n=j.shift(),a.packet.port_id=n,!(j.length>=1))return void(a.error="Insufficient data for message count");a.packet.message_count=j.shift();var o;if(!(j.length>=2))return void(a.error="Insufficient data for sub device");var p=(j.shift()<<8)+j.shift();o=e.reverseLookup(h.SUB_DEVICE,p),a.packet.sub_device=o?o:p;var q;if(!(j.length>=1))return void(a.error="Insufficient data for command class");if(q=j.shift(),o=e.reverseLookup(h.COMMAND_CLASS,q),a.packet.command_class=o?o:q,f.isResponse(q)?(o=e.reverseLookup(h.NACK_REASON,n),a.packet.nack_reason=o?o:e.toHex(q,2,"0x")):a.packet.port_id=n,!(j.length>=2))return void(a.error="Insufficient data for parameter ID");var r=(j.shift()<<8)+j.shift();o=e.reverseLookup(h.PIDS,r),a.packet.param_id=o?o:e.toHex(r,4,"0x");var s;if(!(j.length>=1))return void(a.error="Insufficient data for parameter data length");if(s=j.shift(),a.packet.param_data_length=s,!(j.length>=s))return void(a.error="Insufficient data for parameter data");var t=j.slice(0,s);if(j=j.slice(s),a.packet.param_data=e.arrayToHex(t,"0x"),!(j.length>=2))return j.length&&(k=k.slice(0,-1)),b.info(k),a.packet.calculated_checksum=e.toHex(c.checksumAsValue(k),4,"0x"),void(j=[]);var u=(j.shift()<<8)+j.shift();a.packet.checksum=e.toHex(u,4,"0x"),a.packet.calculated_checksum=e.toHex(c.checksumAsValue(k.slice(0,-2)),4,"0x"),0!==j.length&&(a.error="Extra data after checksum")}}]);
//# sourceMappingURL=rdm.js.map